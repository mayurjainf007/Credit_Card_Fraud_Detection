
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fraud Detection Dashboard</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* Layout and toggle view styling */
        .view { display: none; }
        .active { display: block; }
        
        .container { max-width: 1200px; }
        .table-responsive { overflow-x: auto; }

        /* Custom slider toggle */
        .toggle-container {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 20px;
        }
        .toggle-label {
            font-weight: bold;
            margin: 0 10px;
        }
        .slider {
            position: relative;
            width: 60px;
            height: 34px;
        }
        .slider input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider .slider-round {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: 0.4s;
            border-radius: 34px;
        }
        .slider .slider-round:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: 0.4s;
            border-radius: 50%;
        }
        input:checked + .slider-round {
            background-color: #4CAF50;
        }
        input:checked + .slider-round:before {
            transform: translateX(26px);
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1 class="text-center">Fraud Detection Dashboard</h1>

        <!-- Centered toggle slider with "Result" and "Dashboard" labels -->
        <div class="toggle-container">
            <span class="toggle-label">Result</span>
            <label class="slider">
                <input type="checkbox" id="toggleSwitch">
                <span class="slider-round"></span>
            </label>
            <span class="toggle-label">Dashboard</span>
        </div>

        <!-- Result View with Graph Selection Dropdown -->
        <div id="output-view" class="view active">
            <h2 class="text-center mt-4">Model Output and Evaluation Metrics</h2>

            <!-- Dropdown to select graph -->
            <div class="text-center mt-4">
                <label for="graphSelector" class="form-label"><strong>Select Graph:</strong></label>
                <select id="graphSelector" class="form-select" style="max-width: 300px; margin: auto;">
                    <option value="roc_auc">ROC-AUC Comparison</option>
                    <option value="accuracy">Accuracy Comparison</option>
                    <option value="roc_lr">ROC Curve - Logistic Regression</option>
                    <option value="roc_rf">ROC Curve - Random Forest</option>
                    <option value="confusion_matrix_lr">Confusion Matrix - Logistic Regression</option>
                    <option value="confusion_matrix_rf">Confusion Matrix - Random Forest</option>
                </select>
            </div>

            <!-- Graph display area -->
            <div class="text-center mt-4" id="graphContainer">
                <img id="roc_auc" src="{{ url_for('static', filename='output/model_comparison_plot.png') }}" alt="ROC-AUC Comparison" class="img-fluid graph-image">
                <img id="accuracy" src="{{ url_for('static', filename='output/model_accuracy_plot.png') }}" alt="Accuracy Comparison" class="img-fluid graph-image" style="display: none;">
                <img id="roc_lr" src="{{ url_for('static', filename='output/roc_curve_lr.png') }}" alt="ROC Curve - Logistic Regression" class="img-fluid graph-image" style="display: none;">
                <img id="roc_rf" src="{{ url_for('static', filename='output/roc_curve_rf.png') }}" alt="ROC Curve - Random Forest" class="img-fluid graph-image" style="display: none;">
                <img id="confusion_matrix_lr" src="{{ url_for('static', filename='output/confusion_matrix_lr.png') }}" alt="Confusion Matrix - Logistic Regression" class="img-fluid graph-image" style="display: none;">
                <img id="confusion_matrix_rf" src="{{ url_for('static', filename='output/confusion_matrix_rf.png') }}" alt="Confusion Matrix - Random Forest" class="img-fluid graph-image" style="display: none;">
            </div>

            <h4 class="mt-5">Model Tuning Results</h4>
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead class="table-dark">
                        <tr>
                            <th>Model</th>
                            <th>ROC AUC</th>
                            <th>Accuracy</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for row in results %}
                        <tr>
                            <td>{{ row.Model }}</td>
                            <td>{{ row.ROC_AUC }}</td>
                            <td>{{ row.Accuracy }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Real-Time Transactions View -->
        <div id="dashboard-view" class="view">
            <h2 class="text-center mt-4">Real-Time Transactions</h2>
            <div class="table-responsive">
                <table class="table table-striped table-hover mt-3">
                    <thead class="table-dark">
                        <tr>
                            <th>Transaction Time</th>
                            <th>Amount</th>
                            <th>First Name</th>
                            <th>Last Name</th>
                            <th>Merchant</th>
                            <th>Category</th>
                            <th>Prediction</th>
                        </tr>
                    </thead>
                    <tbody id="transaction-data">
                    </tbody>
                </table>
            </div>
            <form action="/download" method="get" class="text-center mt-3">
                <button type="submit" class="btn btn-primary">Download Fraudulent Transactions CSV</button>
            </form>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function () {
            // Toggle between views using a slider
            document.getElementById("toggleSwitch").addEventListener("change", function() {
                $("#dashboard-view, #output-view").toggleClass("active");
            });
            
            // Functionality to change displayed graph based on dropdown selection
            $('#graphSelector').on('change', function() {
                $('.graph-image').hide(); // Hide all graphs
                $('#' + this.value).show(); // Show selected graph
            });

            // Polling for new transactions (automatic updates every 5 seconds)
            setInterval(() => {
                $.get("/api/transactions", function (data) {
                    // Replace table content with updated transactions
                    let transactionRows = "";
                    data.forEach(transaction => {
                        transactionRows += `
                            <tr>
                                <td>${transaction.trans_date_trans_time}</td>
                                <td>${transaction.amt}</td>
                                <td>${transaction.first}</td>
                                <td>${transaction.last}</td>
                                <td>${transaction.merchant}</td>
                                <td>${transaction.category}</td>
                                <td>${transaction.prediction}</td>
                            </tr>
                        `;
                    });
                    $("#transaction-data").html(transactionRows);
                });
            }, 5000);  // Interval for polling
        });
    </script>
</body>
</html>
